# Database Container
FROM backrest/u14-base

# Create PostgreSQL user/group
RUN groupadd -g5000 postgres
RUN adduser --uid=5000 --ingroup=postgres --disabled-password --gecos "" postgres

# Setup SSH
RUN mkdir /home/postgres/.ssh
COPY id_rsa  /home/postgres/.ssh/id_rsa
COPY id_rsa.pub  /home/postgres/.ssh/authorized_keys
RUN chown -R postgres:postgres /home/postgres/.ssh
RUN chmod 700 /home/postgres/.ssh
RUN echo 'Host *' > /home/postgres/.ssh/config
RUN echo '    StrictHostKeyChecking no' >> /home/postgres/.ssh/config
RUN echo '    LogLevel quiet' >> /home/postgres/.ssh/config

# Create pg_backrest.conf
RUN touch /etc/pg_backrest.conf
RUN chmod 640 /etc/pg_backrest.conf
RUN chown postgres:postgres /etc/pg_backrest.conf

# Install PostgreSQL
RUN apt-get install -y postgresql-9.4
RUN pg_dropcluster --stop 9.4 main

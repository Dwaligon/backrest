# Base Container
FROM ubuntu:14.04

# Install SSH
RUN apt-get -y install openssh-server

# Add PostgreSQL packages
RUN echo 'deb http://apt.postgresql.org/pub/repos/apt/ trusty-pgdg main 9.5' >> /etc/apt/sources.list.d/pgdg.list
RUN wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
RUN sudo apt-get update

# Create test group
RUN groupadd -g6000 admin
RUN sed -i 's/^\%admin.*$/\%admin ALL\=\(ALL\) NOPASSWD\: ALL/' /etc/sudoers

# Create test user
RUN adduser --uid=6000 --ingroup=admin --disabled-password --gecos "" vagrant

# Suppress dpkg interactive output
RUN rm /etc/apt/apt.conf.d/70debconf

# Start SSH when container starts
ENTRYPOINT service ssh restart && bash
